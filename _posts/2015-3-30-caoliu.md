---
layout: post
title:  "草榴社区入会指南"
date:   2014-11-14 17:50:43
categories: za
---


意外看见一个草榴的注册链接`http://76.164.225.76/u/?id=xxx`。早在高中就听说过草榴的大名，于是我
满心欢喜的去注册了一个账号。激动的打开一个标称无码的页面，结果却是跳到了另一个页面，告诉我不是会员，
并提供了一个方法：将这个链接`http://76.164.225.76/u/?id=dadaha`（dadaha 就是我的账号）发到各个
群组，论坛~~当有超过50个人通过这个链接注册的话，我就会自动提为会员。这和一些网站推广返利的方法类似。


我想到是否能够编程完成这50个注册的任务。首先，我用`wireshark`抓取我手动注册过程中的数据包
（用的fitter是ip.addr == 76.164.225.76 and http)。我对这些HTTP数据包的cookie部分做了一点分析，感觉
关系有点复杂。我本想着利用ruby的net/http模块模拟这一过程，实现自动化。做了一些尝试后，觉得这不怎靠
普。

**为什么我要模拟浏览器，而放着完备的chrome,firefox不用？因为我不能控制浏览器的行为，除了用鼠标和键盘。真的不
能么？哦，还有JavaScript！**

**浏览器就像一个操作系统，它提供了一些API，而JavaScript是唯一可以使用它的高级语言。**


我写了这样一段伪码
    location.href = 'http://76.164.225.76/reg.asp'
    regname.value = radom()
    regpwd.value = regpwdrepeat.value = radom()
    document.forms[0].submit()
    cookie.deletAll()


这确实能够完成注册过程，但是如何能重复的执行它？一个循环语句不就搞定了么？问题是，每当执行第一句后，页面被重新加载，
JavaScript的执行环境重置，代码无法继续执行下去。

解决方法是这样的：`window.open` 可以打开一个新的窗口。基于这个，我可以在一个窗口中保持一个新打开窗口的引用`w`,这样
就可以在这个页面重复执行上面的代码，而不会被新页面的变动而影响。

完成后，我马上登上我原来的账号，可是推广数任然没有达到变化。这时，我突然看到网页上方赫然写着你的ip是xxx.xxx.xxx.xxx.
THE END.

